<script src="lib/p5.js"></script>
<script>

p5.prototype.circle = function(x, y, r)
{
    this.ellipse(x, y, r * 2, r * 2);
}

var g;

function setup()
{
    createCanvas(800, 600);

    g = createGraphics(800, 600);
    g.pixelDensity(1);
    g.background('pink');
    saveP5GlobalFunctions();
}

function draw()
{
    bindP5GlobalFunctions(g);
    drawStaticPicture();
    restoreP5GlobalFunctions();

    image(g, 0, 0);
}


function mouseClicked()
{
    ellipse(mouseX, mouseY, 20);
}

function mouseMoved()
{
    g.mouseY = mouseY;
    handleMouseMoved();
}

function handleMouseMoved()
{
    console.log(window.mouseX, mouseY);
}

function drawStaticPicture()
{
    dostuff();

    function dostuff()
    {
        background("lightblue");
        ellipse(0, 0, 10);
        ellipse(width, 0, 10);
        ellipse(0, height, 10);
        ellipse(width, height, 10);
        circle(width / 2, height /2, 50)

        ellipse(100, 100, 100);
    }
}


// --------------------------

function saveP5GlobalFunctions()
{
    var o = {};

    for (var p in p5.prototype) 
    {
        if (typeof p5.prototype[p] === 'function') 
        {
            o[p] = window[p]
        }
    }

    window.P5Functions = o;
}


function restoreP5GlobalFunctions()
{
    var o = window.P5Functions;
    if (!o)
        return;
    
    for (var p in p5.prototype) 
    {
        if (typeof p5.prototype[p] === 'function') 
        {
            window[p] = o[p];
        }
    }
}


function bindP5GlobalFunctions(oGraphics)
{
    for (var p in p5.prototype) 
    {
        if (typeof p5.prototype[p] === 'function') 
        {
            window[p] = p5.prototype[p].bind(oGraphics);
        }
    }
}


</script>




