<script>


var code = `background ( "pink" );
        do this();

        somethink like this
        song ( "blah" );
        background ( "green");

`;

// var n = _eatSpaceFind("(", ["("], 0);
// console.log(n);

// var s = _findFirstParameter(code, "background", 0);
// console.log(s);

// var ar = findFirstParameter(code, "background");
// console.log(ar);

// var s = _trimQuotes(`z`);
// console.log(s);

// var ar = _findFunction(`preload ; preload("player", "asterisk", "image");preload("alt par", "inca un par");`, "preload");
// console.log(ar);

var ar = findFirstParameter(`preload ; preload("player", "asterisk", "image");preload("alt par", "inca un par");preload(`, "preload");
console.log(ar);

var ar = findAllParameters(`preload ; preload("player", "asterisk", "image");preload("alt par", "inca un par");preload(`, "preload");
console.log(ar);


// Find all parameters of specified function
function findAllParameters(code, fnName)
{
    var ar = [];
    var pos = 0;

    var arFunctions = _findFunction(code, fnName);

    for(var position of arFunctions)
    {
        var oPar = _findAllParameters(code, fnName, position);
        if (oPar)
            ar = ar.concat(oPar.values);
    }

    return ar;
}


function _findAllParameters(code, fnName, startPos)
{
    var pos = code.indexOf(fnName, startPos);
    if (pos < 0)
        return null;

    var fromIndex = _eatSpaceFind(code, ["("], pos + fnName.length);
    if (fromIndex < 0)
        return null;

    var toIndex = code.indexOf(")", fromIndex);
    if (toIndex < 0)
        return null;

    var txtParams = code.substring(fromIndex + 1, toIndex);
    if (!txtParams)
        return null;

    var arParams = txtParams.split(",");
    for(var i = 0; i < arParams.length; i++)
    {
        arParams[i] = _trimQuotes(arParams[i]);
    }

    return { values: arParams, fromIndex : fromIndex, toIndex : toIndex };
}


// Returns an array with values of first string parameters of specified function
function findFirstParameter(code, fnName)
{
    var ar = [];
    var pos = 0;

    var arFunctions = _findFunction(code, fnName);

    for(var position of arFunctions)
    {
        var oPar = _findFirstParameter(code, fnName, position);
        if (oPar)
            ar = ar.concat(oPar.value);
    }

    return ar;
}

// Find the first parameter of specified function starting with specified position
function _findFirstParameter(code, fnName, startPos)
{
    var pos = code.indexOf(fnName, startPos);
    if (pos < 0)
        return null;

    var fromIndex = _eatSpaceFind(code, ["("], pos + fnName.length);
    if (fromIndex < 0)
        return null;

    fromIndex = _eatSpaceFind(code, [`"`, `'`, "`"], fromIndex + 1);
    if (fromIndex < 0)
        return null;

    var quoteChar = code[fromIndex];

    var toIndex = code.indexOf(quoteChar, fromIndex + 1);
    if (toIndex < 0)
        return null;

    var value = code.substring(fromIndex + 1, toIndex);
    return { value:value, fromIndex:fromIndex, toIndex:toIndex };
}


function _findFunction(code, fnName)
{
    var ar = [];
    var pos = 0;

    while(true)
    {
        pos = code.indexOf(fnName, pos);
        if (pos < 0)
            break;

        ar.push(pos);
        pos += fnName.length;
    }

    return ar;
}


function _trimQuotes(txt)
{
    if(!txt)
        return txt;

    var s = txt.trim();
    var arQuotes = [`"`, `'`, "`"];

    var fromIndex = arQuotes.indexOf( s[0] ) >= 0 ? 1 : 0;
    var toIndex = arQuotes.indexOf( s[s.length - 1] ) >= 0 ? s.length - 1 : s.length;
    
    return s.substring(fromIndex, toIndex);
}



// Search allText for one of the specified chars in the array and returns it's position if found
// The function starts at specified position and ignores white spaces
function _eatSpaceFind(allText, arExpectedChars, startPos)
{
    if (!allText || !arExpectedChars)
        return -1;

    var i = startPos;
    var n = allText.length;

    while(i < n)
    {
        var c = allText[i];
        if (c == " " || c == "\t" || c == "\r" || c == "\n")
        {
            i++;
            continue;
        }

        if (arExpectedChars.indexOf(c) >= 0)
            return i;
        
        break;
    }

    return -1;
}



</script>
